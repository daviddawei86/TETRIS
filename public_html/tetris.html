<!DOCTYPE html>
<!--
To change this license header, choose License Headers in Project Properties.
To change this template file, choose Tools | Templates
and open the template in the editor.
-->
<html>
    <head>
        <title>DAVID RODRIGUEZ</title>
        <meta charset="UTF-8">

    </head>
    <body>
        <p id="demo"></p>



        <!-- Imatges que farem servir en el nostre espai de dibuix, estan ocultades -->
        <img src="verde.png" id="verde" style="display: none;">
        <img src="pared.png" id="pared" style="display: none;">
        <img src="blanco.png" id="blanco" style="display: none;">

        <!-- Espai de dibuix -->
        <canvas id="espai" width="5000" height="5000"> </canvas>
        <script>

            var ok = true;

            var TETRIS = function () {

                this.contadorPiezas = new Array();
                this.tablero = new Array();
                this.estadoTablero = 0;
                this.puntuacion = 0;
                this.puntuacionMaxima = 0;
                this.piezaActual = new Array();
            }

            TETRIS.prototype.iniciarJuego = function () {


                this.tablero = [

                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1],
                    [1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1],
                ];
                this.contadorPiezas = new Array();
                this.contadorPiezas = {"i": 0, "j": 0, "l": 0, "o": 0, "s": 0, "t": 0, "z": 0};

            }

            var r = new TETRIS();
            r.iniciarJuego();

            TETRIS.prototype.piezaSiguiente = function () {



            }
            TETRIS.prototype.teclado = function () {

            }
            TETRIS.prototype.movimientoAutomatico = function () {
                p.x = p.x + 1;
            }


            var Pieza = function (forma, color, x, y)
            {
                this.forma = forma;
                this.color = color;
                this.x = x;
                this.y = y;
            };

            Pieza.prototype.moureDreta = function ()
            {
                p.x = p.x - 1;
            };
            Pieza.prototype.moureEsquerra = function ()
            {
                p.x = p.x + 1;
            };
            Pieza.prototype.moureAvall = function ()
            {
                p.y = p.y + 1;
            };
            Pieza.prototype.rotarDreta = function () {
                var formaNova = new Array();
                for (var i = 0; i < this.forma.length; i++) {
                    formaNova[i] = new Array();
                    for (var j = 0; j < this.forma[i].length; j++) {
                        formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                    }
                }
                this.forma = formaNova;
            }


            var pa = GeneraPecaAleatoria();
            var p = new Pieza(pa[0], pa[1], 0, 4);



            Pieza.prototype.rotarEsquerra = function () {
                var formaNova = new Array();
                for (var i = 0; i < this.forma.length; i++) {
                    formaNova[i] = new Array();
                    for (var j = 0; j < this.forma[i].length; j++) {
                        formaNova[i][j] = this.forma[this.forma[i].length - 1 - j][i];
                    }
                }
                this.forma = formaNova;
            }

            Pieza.prototype.pintar = function ()
            {
                var resultat = "<table border='1'>";
                for (var i = 0; i < this.forma.length; i++)
                {
                    resultat = resultat + "<tr>"
                    for (var j = 0; j < this.forma[i].length; j++)
                    {
                        resultat = resultat + "<td>";
                        if (this.forma[i][j] == 2) {
                            resultat = resultat + "X"
                        } else {
                            resultat = resultat + "-"
                        }
                        ;
                        resultat = resultat + "</td>";
                    }
                    resultat = resultat + "</tr>";
                }
                resultat = resultat + "</table>";
                return resultat
            };


            document.getElementById("demo").innerHTML = p.pintar();

            function GeneraPecaAleatoria()
            {
                var peces = [
                    [[[0, 0, 0, 0],
                            [0, 2, 2, 0],
                            [0, 2, 2, 0],
                            [0, 0, 0, 0]], "groc"],

                    [[[0, 2, 0, 0],
                            [0, 2, 0, 0],
                            [0, 2, 0, 0],
                            [0, 2, 0, 0]], "lila"],

                    [[[0, 0, 0, 0],
                            [0, 2, 2, 0],
                            [2, 2, 0, 0],
                            [0, 0, 0, 0]], "verd"],

                           [[[0, 0, 0, 0],
                            [0, 2, 2, 0],
                            [0, 0, 2, 2],
                            [0, 0, 0, 0]], "roig"],

                    [[[0, 2, 0, 0],
                            [0, 2, 0, 0],
                            [0, 2, 2, 0],
                            [0, 0, 0, 0]], "blau"],

                    [[[0, 2, 2, 0],
                            [0, 2, 0, 0],
                            [0, 2, 0, 0],
                            [0, 0, 0, 0]], "taronga"],

                          [[[0, 0, 0, 0],
                            [2, 2, 2, 0],
                            [0, 2, 0, 0],
                            [0, 0, 0, 0]], "morat"]]
                var numeroAleatori = Math.round(Math.random() * 6);
                return peces[numeroAleatori];
            }


            function reFresh() {

                function pintar2() {

                    var canvas = document.getElementById("espai");
                    var ctx = canvas.getContext("2d");
                    ctx.clearRect(0, 0, 5000, 5000);

                    var img;


                    for (var i = 0; i < r.tablero.length; i++) {
                        for (var j = 0; j < r.tablero[i].length; j++) {

                            if (r.tablero[i][j] == 1) {

                                img = document.getElementById("pared");
                            } else
                            {
                                if (r.tablero[i][j] == 0) {
                                    img = document.getElementById("blanco");
                                }


                                for (var m = 0; m < p.forma.length; m++) {
                                    for (var n = 0; n < p.forma[m].length; n++) {
                                        if (p.x + m == i && p.y + n == j && p.forma[m][n] == 2) {

                                            img = document.getElementById("verde");

                                        }

                                    }
                                }

                            }
                            ctx.drawImage(img, j * 20, i * 20, 20, 20);
                        }
                    }
                }

                pintar2();
                colisionPiezas();

                function colisionPiezas() {

                    if (p.color == "groc" || p.color == "verd" || p.color == "groc" || p.color == "blau" || p.color == "taronga" || p.color == "morat") {
                        var ok = false;


                        if (r.tablero[p.x][p.y + 1] == 0 && r.tablero[p.x + 1][p.y + 1] == 0 && r.tablero[p.x + 2][p.y + 1] == 0 && r.tablero[p.x + 3][p.y + 1] == 0 && r.tablero[p.x + 4][p.y + 1] == 0) {
                            ok = true;
                            if (r.tablero[p.x][p.y + 2] == 0 && r.tablero[p.x + 1][p.y + 2] == 0 && r.tablero[p.x + 2][p.y + 2] == 0 && r.tablero[p.x + 3][p.y + 2] == 0 && r.tablero[p.x + 4][p.y + 2] == 0 && ok == true) {
                                ok = true;

                                if (r.tablero[p.x][p.y + 3] == 0 && r.tablero[p.x + 1][p.y + 3] == 0 && r.tablero[p.x + 2][p.y + 3] == 0 && r.tablero[p.x + 3][p.y + 3] == 0 && r.tablero[p.x + 4][p.y + 3] == 0 && ok == true) {
                                    ok = true;
                                } else {
                                    ok = false
                                }
                            } else {
                                ok = false
                            }
                        } else {
                            ok = false
                        }
                    }

                    if (p.color == "lila") {
                        var ok = false;

                        if (r.tablero[p.x][p.y + 1] == 0 && r.tablero[p.x + 2][p.y + 4] == 0) {
                            ok = true;
                            if (r.tablero[p.x][p.y + 2] == 0 && ok == true) {
                                ok = true;

                            } else {
                                ok = false
                            }
                        } else {
                            ok = false
                        }
                    }

                    if (p.color == "roig") {
                        var ok = false;

                        if (r.tablero[p.x][p.y + 1] == 0) {
                            ok = true;
                            if (r.tablero[p.x][p.y + 4] == 0 && ok == true) {
                                ok = true;

                            } else {
                                ok = false
                            }
                        } else {
                            ok = false
                        }
                    }


                    if (ok == true) {
                        r.movimientoAutomatico();
                    }
                }
            }

            var id = setInterval(reFresh, 100);

        </script>

    </body>
</html>
